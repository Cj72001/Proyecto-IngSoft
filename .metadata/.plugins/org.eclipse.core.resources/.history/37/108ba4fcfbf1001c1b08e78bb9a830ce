package com.nilesh.springCRUD.controller;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.servlet.ModelAndView;

import com.nilesh.springCRUD.model.Role;
import com.nilesh.springCRUD.model.Student;
import com.nilesh.springCRUD.model.User;
import com.nilesh.springCRUD.services.RoleServices;
import com.nilesh.springCRUD.services.StudentServices;
import com.nilesh.springCRUD.services.UserServices;
import com.nilesh.springCRUD.services.User_RolesServices;

@Controller
public class AppController {

	@Autowired
	StudentServices service;
	RoleServices Rs;
	UserServices Us;
	User_RolesServices URs;
	
	
	
	@RequestMapping("/")
	public String viewHomePage(Model model) {
		List<Student> listStudent = service.listAll();
		model.addAttribute("listStudent",listStudent);
		
		Role roleUser = new Role();
		roleUser.setId(1);
		roleUser.setName("USER");
		Rs.createRole(roleUser);
		
		Role roleAdmin = new Role();
		roleAdmin.setId(1);
		roleAdmin.setName("ADMIN");
		Rs.createRole(roleAdmin);
		
		
		User userU = new User();
		userU.setUsername("Omar");
		userU.setPassword("123");
		userU.setEnabled(true);
		Us.createUser(userU);
		
		User userA = new User();
		userA.setUsername("Caroline");
		userA.setPassword("123");
		userU.setEnabled(true);
		Us.createUser(userA);
		
		
		return "index";
	}
	
//	INSERT INTO roles (name) VALUES ('USER');
//	INSERT INTO roles (name) VALUES ('CREATOR');
//	INSERT INTO roles (name) VALUES ('EDITOR');
//	INSERT INTO roles (name) VALUES ('ADMIN');
//
//	INSERT INTO users (username, password, enabled) VALUES ('nilesh', '$2a$10$OlpVGGz1EXm.LQ/OcvmBQOFdAe3FQNYhOOXrKD6y9fhxOr2aBKwHu', '1');
//	INSERT INTO users (username, password, enabled) VALUES ('mahesh', '$2a$10$lv8PTtiNw7injglznpYeIehWW6knfFe/RnUW16TmGKtfSWRm/V2z2', '1');
//	INSERT INTO users (username, password, enabled) VALUES ('suresh', '$2a$10$flDL1ovH.7JEy1lSpBuuHuqagrXA8K3j3ELXQFV/KXhQK.WSnP8a.', '1');
//	INSERT INTO users (username, password, enabled) VALUES ('ramesh', '$2a$10$9k8/ODt16QFCmcmXLO2.oeVR8gHUtqpw9JeoEwEx/BKKAX9BZbbHK', '1');
//	INSERT INTO users (username, password, enabled) VALUES ('admin', '$2a$10$bN7OWEvi6rTqJEYbZfDOg.FHmG.xPTDxJR1k9LzsR4O6Nt8zuIKwq', '1');
//
//	INSERT INTO users_roles (user_id, role_id) VALUES (1, 1); 
//	INSERT INTO users_roles (user_id, role_id) VALUES (2, 2); 
//	INSERT INTO users_roles (user_id, role_id) VALUES (3, 3); 
//	INSERT INTO users_roles (user_id, role_id) VALUES (4, 2); 
//	INSERT INTO users_roles (user_id, role_id) VALUES (4, 3); 
//	INSERT INTO users_roles (user_id, role_id) VALUES (5, 4);
	
	@RequestMapping("/new")
	public String newStudentPage(Model model) {
		Student student=new Student();
		model.addAttribute(student);
		return "new_student";
	}
	
	@RequestMapping(value = "/save", method =RequestMethod.POST)
	public String saveStudent(@ModelAttribute("student") Student student ) {
		service.save(student);
		return "redirect:/";
	}
	@RequestMapping("/edit/{sid}")
	public ModelAndView showEditStudentPage(@PathVariable (name="sid") Long sid) {
		ModelAndView mav=new ModelAndView("edit_student");
		Student student=service.get(sid);
		mav.addObject("student",student);
		return mav;
	}
	
	@RequestMapping("/delete/{sid}")
	public String deleteStudentPage(@PathVariable (name="sid") Long sid) {
		service.delete(sid);
		return "redirect:/";
	}
	
}
